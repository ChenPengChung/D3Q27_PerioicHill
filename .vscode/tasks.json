{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "SSH to cfdlab",
      "type": "shell",
      "command": "& '${workspaceFolder}\\.vscode\\ssh-connect.ps1' -ServerCombo '${input:serverCombo}'",
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": true
      },
      "runOptions": {
        "runOn": "folderOpen"
      },
      "problemMatcher": []
    },
    {
      "label": "Reconnect",
      "type": "shell",
      "command": "& '${workspaceFolder}\\.vscode\\ssh-connect.ps1' -ServerCombo '${input:serverCombo}'",
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": true
      },
      "problemMatcher": []
    },
    {
      "label": "Switch Node",
      "type": "shell",
      "command": "& '${workspaceFolder}\\.vscode\\ssh-connect.ps1' -ServerCombo '${input:serverCombo}'",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": true
      },
      "problemMatcher": []
    },
    {
      "label": "SSH to cfdlab (.87)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "chenpengchung@140.114.58.87",
        "-t",
        "ssh -t cfdlab-ib${input:nodeFor87} 'cd /home/chenpengchung/D3Q27_PeriodicHill; exec bash'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": true
      },
      "problemMatcher": []
    },
    {
      "label": "SSH to cfdlab (.154)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "chenpengchung@140.114.58.154",
        "-t",
        "ssh -t cfdlab-ib${input:nodeFor154} 'cd /home/chenpengchung/D3Q27_PeriodicHill; exec bash'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": true
      },
      "problemMatcher": []
    },
    {
      "label": "Switch Node (.87)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "chenpengchung@140.114.58.87",
        "-t",
        "ssh -t cfdlab-ib${input:nodeFor87} 'cd /home/chenpengchung/D3Q27_PeriodicHill; exec bash'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": true
      },
      "problemMatcher": []
    },
    {
      "label": "Switch Node (.154)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "chenpengchung@140.114.58.154",
        "-t",
        "ssh -t cfdlab-ib${input:nodeFor154} 'cd /home/chenpengchung/D3Q27_PeriodicHill; exec bash'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": true
      },
      "problemMatcher": []
    },
    {
      "label": "Reconnect (.87)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "chenpengchung@140.114.58.87",
        "-t",
        "ssh -t cfdlab-ib${input:nodeFor87} 'cd /home/chenpengchung/D3Q27_PeriodicHill; exec bash'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": true
      },
      "problemMatcher": []
    },
    {
      "label": "Reconnect (.154)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "chenpengchung@140.114.58.154",
        "-t",
        "ssh -t cfdlab-ib${input:nodeFor154} 'cd /home/chenpengchung/D3Q27_PeriodicHill; exec bash'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "new",
        "focus": true
      },
      "problemMatcher": []
    },
    {
      "label": "Compile + Run (.87)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "-batch",
        "chenpengchung@140.114.58.87",
        "ssh cfdlab-ib${input:nodeFor87} 'cd /home/chenpengchung/D3Q27_PeriodicHill && nvcc main.cu -arch=sm_35 -I/home/chenpengchung/openmpi-3.0.3/include -L/home/chenpengchung/openmpi-3.0.3/lib -lmpi -o a.out && nohup mpirun -np ${input:gpuCount} ./a.out > log$(date +%Y%m%d) 2>&1 &'"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Compile + Run (.154)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "-batch",
        "chenpengchung@140.114.58.154",
        "ssh cfdlab-ib${input:nodeFor154} 'cd /home/chenpengchung/D3Q27_PeriodicHill && nvcc main.cu -arch=sm_35 -I/home/chenpengchung/openmpi-3.0.3/include -L/home/chenpengchung/openmpi-3.0.3/lib -lmpi -o a.out && nohup mpirun -np ${input:gpuCount} ./a.out > log$(date +%Y%m%d) 2>&1 &'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Check Running Jobs (.87)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "-batch",
        "chenpengchung@140.114.58.87",
        "ssh cfdlab-ib${input:nodeFor87} 'ps aux | grep a.out | grep -v grep'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Check Running Jobs (.154)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "-batch",
        "chenpengchung@140.114.58.154",
        "ssh cfdlab-ib${input:nodeFor154} 'ps aux | grep a.out | grep -v grep'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Kill Running Job (.87)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "-batch",
        "chenpengchung@140.114.58.87",
        "ssh cfdlab-ib${input:nodeFor87} 'pkill -f a.out || pkill mpirun'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Kill Running Job (.154)",
      "type": "process",
      "command": "C:\\Program Files\\PuTTY\\plink.exe",
      "args": [
        "-ssh",
        "-pw", "1256",
        "-batch",
        "chenpengchung@140.114.58.154",
        "ssh cfdlab-ib${input:nodeFor154} 'pkill -f a.out || pkill mpirun'"
      ],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Auto Sync (Watch)",
      "type": "shell",
      "command": "& 'c:\\Users\\88697.CHENPENGCHUNG12\\Desktop\\GitHub-PeriodicHill\\D3Q27_PeriodicHill\\.vscode\\mobaxterm.ps1' watch",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": false
      },
      "isBackground": true,
      "problemMatcher": []
    },
    {
      "label": "Quick Sync (Push if changed)",
      "type": "shell",
      "command": "& 'c:\\Users\\88697.CHENPENGCHUNG12\\Desktop\\GitHub-PeriodicHill\\D3Q27_PeriodicHill\\.vscode\\mobaxterm.ps1' autopush",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Build main.exe (MinGW)",
      "type": "shell",
      "command": "C:/Strawberry/c/bin/g++.exe",
      "args": [
        "-std=c++17",
        "-O3",
        "-g",
        "-fopenmp",
        "${workspaceFolder}\\main.cpp",
        "-o",
        "${workspaceFolder}\\main.exe"
      ],
      "options": {
        "shell": {
          "executable": "powershell.exe"
        },
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": ["$gcc"],
      "group": {
        "kind": "build",
        "isDefault": false
      }
    },
    {
      "type": "cppbuild",
      "label": "C/C++: g++.exe build active file",
      "command": "C:/Strawberry/c/bin/g++.exe",
      "args": [
        "-fdiagnostics-color=always",
        "-g",
        "${file}",
        "-o",
        "${fileDirname}\\${fileBasenameNoExtension}.exe",
        "-fopenmp"
      ],
      "options": {
        "cwd": "C:/Strawberry/c/bin"
      },
      "problemMatcher": ["$gcc"],
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "detail": "Task generated by Debugger."
    }
  ],
  "inputs": [
    {
      "id": "serverCombo",
      "type": "pickString",
      "description": "選擇連線目標 (母機 → 子機)",
      "options": [
        {"label": ".87 → ib2", "value": "87:2"},
        {"label": ".87 → ib3", "value": "87:3"},
        {"label": ".87 → ib5", "value": "87:5"},
        {"label": ".87 → ib6", "value": "87:6"},
        {"label": ".154 → ib1", "value": "154:1"},
        {"label": ".154 → ib4", "value": "154:4"},
        {"label": ".154 → ib7", "value": "154:7"},
        {"label": ".154 → ib9", "value": "154:9"}
      ],
      "default": "87:3"
    },
    {
      "id": "nodeFor87",
      "type": "pickString",
      "description": "選擇子機 (via .87)",
      "options": [
        {"label": "ib2", "value": "2"},
        {"label": "ib3", "value": "3"},
        {"label": "ib5", "value": "5"},
        {"label": "ib6", "value": "6"}
      ],
      "default": "3"
    },
    {
      "id": "nodeFor154",
      "type": "pickString",
      "description": "選擇子機 (via .154)",
      "options": [
        {"label": "ib1", "value": "1"},
        {"label": "ib4", "value": "4"},
        {"label": "ib7", "value": "7"},
        {"label": "ib9", "value": "9"}
      ],
      "default": "4"
    },
    {
      "id": "gpuCount",
      "type": "pickString",
      "description": "選擇要使用幾顆 GPU",
      "options": ["4", "8"],
      "default": "4"
    }
  ]
}
